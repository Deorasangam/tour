<%- include('../components/header', { pageTitle: 'Dashboard' }) %>

<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-icon primary">
      <i class="fas fa-layer-group"></i>
    </div>
    <div class="stat-info">
      <div class="stat-value"><%= sections.length %></div>
      <div class="stat-label">Total Sections</div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon success">
      <i class="fas fa-check-circle"></i>
    </div>
    <div class="stat-info">
      <div class="stat-value">
        <%= sections.filter(section => section.isActive).length %>
      </div>
      <div class="stat-label">Active Sections</div>
    </div>
  </div>

  <div class="stat-card">
    <div class="stat-icon warning">
      <i class="fas fa-eye-slash"></i>
    </div>
    <div class="stat-info">
      <div class="stat-value">
        <%= sections.filter(section => !section.isActive).length %>
      </div>
      <div class="stat-label">Hidden Sections</div>
    </div>
  </div>

  <% if (user.role === 'admin') { %>
  <div class="stat-card">
    <div class="stat-icon secondary">
      <i class="fas fa-users"></i>
    </div>
    <div class="stat-info">
      <div class="stat-value"><%= userCount || 0 %></div>
      <div class="stat-label">Total Users</div>
    </div>
  </div>
  <% } %>
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Quick Actions</h2>
  </div>
  <div class="card-body">
    <div class="d-flex" style="gap: 15px; flex-wrap: wrap">
      <a href="/admin/sections" class="btn btn-primary">
        <i class="fas fa-list"></i>
        Manage Sections
      </a>

      <% if (user.role === 'admin') { %>
      <a href="/admin/users" class="btn btn-secondary">
        <i class="fas fa-users"></i>
        Manage Users
      </a>
      <% } %>

      <a href="/admin/create-page" class="btn btn-info">
        <i class="fas fa-file-alt"></i>
        Create Page
      </a>

      <a href="/admin/pages" class="btn btn-info">
        <i class="fas fa-file-code"></i>
        Manage Pages
      </a>

      <a href="/" target="_blank" class="btn btn-success">
        <i class="fas fa-external-link-alt"></i>
        View Website
      </a>
    </div>
  </div>
</div>

<div class="card">
  <div class="card-header">
    <h2 class="card-title">Recent Activity</h2>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Section</th>
            <th>Last Updated</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <% var recentSections = [...sections].sort(function(a, b) { return new
          Date(b.lastUpdated) - new Date(a.lastUpdated); }).slice(0, 5); %> <%
          if (recentSections.length === 0) { %>
          <tr>
            <td colspan="4" class="text-center">No recent activity</td>
          </tr>
          <% } else { %> <% recentSections.forEach(function(section) { %>
          <tr>
            <td>
              <div class="d-flex align-items-center">
                <div
                  style="
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: var(--primary-color);
                    margin-right: 10px;
                  "
                >
                  <i class="<%= section.icon %>"></i>
                </div>
                <%= section.displayName %>
              </div>
            </td>
            <td>
              <% var updatedDate = new Date(section.lastUpdated); var
              formattedDate = updatedDate.toLocaleString('en-US', { year:
              'numeric', month: 'short', day: 'numeric', hour: '2-digit',
              minute: '2-digit' }); %> <%= formattedDate %>
            </td>
            <td>
              <% if (section.isActive) { %>
              <span class="badge badge-success">Active</span>
              <% } else { %>
              <span class="badge badge-danger">Hidden</span>
              <% } %>
            </td>
            <td>
              <a
                href="/admin/sections/<%= section._id %>"
                class="btn btn-sm btn-primary"
              >
                <i class="fas fa-edit"></i> Edit
              </a>
            </td>
          </tr>
          <% }); %> <% } %>
        </tbody>
      </table>
    </div>
  </div>
  <div class="card-footer">
    <a href="/admin/sections" class="btn btn-sm btn-secondary">
      <i class="fas fa-list"></i> View All Sections
    </a>
  </div>
</div>

<%- include('../components/footer') %>
